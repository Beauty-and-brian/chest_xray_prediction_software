{% load static %}
<!doctype html>
<html class="no-js" lang="zxx">
    <head>
        <!-- Meta Tags -->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="keywords" content="Site keywords here">
		<meta name="description" content="">
		<meta name='copyright' content=''>
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		
		<!-- Title -->
        <title>Medical Health Center</title>
		
		<!-- Favicon -->
        <link rel="icon" href="{% static 'img/favicon.png' %}">
		
		<!-- Google Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" rel="stylesheet">

		<link rel="stylesheet" href="{% static 'jquery.loadingModal.css' %}">
		<link rel="stylesheet" href="{% static 'busy_indicator.css' %}">


		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
		<!-- Nice Select CSS -->
		<link rel="stylesheet" href="{% static 'css/nice-select.css' %}">
		<!-- Font Awesome CSS -->
        <link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">
		<!-- icofont CSS -->
        <link rel="stylesheet" href="{% static 'css/icofont.css' %}">
		<!-- Slicknav -->
		<link rel="stylesheet" href="{% static 'css/slicknav.min.css' %}">
		<!-- Owl Carousel CSS -->
        <link rel="stylesheet" href="{% static 'css/owl-carousel.css' %}">
		<!-- Datepicker CSS -->
		<link rel="stylesheet" href="{% static 'css/datepicker.css' %}">
		<!-- Animate CSS -->
        <link rel="stylesheet" href="{% static 'css/animate.min.css' %}">
		<!-- Magnific Popup CSS -->
        <link rel="stylesheet" href="{% static 'css/magnific-popup.css' %}">
		
		<!-- Medipro CSS -->
        <link rel="stylesheet" href="{% static 'css/normalize.css' %}">
        <link rel="stylesheet" href="{% static 'style.css' %}">
        <link rel="stylesheet" href="{% static 'css/responsive.css' %}">

		<link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>

		
    </head>
    <body>

		<!-- Preloader -->
        <div class="preloader">
            <div class="loader">
                <div class="loader-outter"></div>
                <div class="loader-inner"></div>

                <div class="indicator"> 
                    <svg width="16px" height="12px">
                        <polyline id="back" points="1 6 4 6 6 11 10 1 12 6 15 6"></polyline>
                        <polyline id="front" points="1 6 4 6 6 11 10 1 12 6 15 6"></polyline>
                    </svg>
                </div>
            </div>
        </div>
        <!-- End Preloader -->
		
		<!-- Header Area -->
		<header class="header" >
			<!-- Header Inner -->
			<div class="header-inner">
				<div class="container">
					<div class="inner">
						<div class="row">
							<div class="col-lg-3 col-md-3 col-12">
								<!-- Start Logo -->
								<div class="logo">
									<a href="javascript.void(0)"><img src="{% static 'img/logo.png' %}" alt="#" height="150" width="150" ></a>
								</div>
								<!-- End Logo -->
								<!-- Mobile Nav -->
								<div class="mobile-nav"></div>
								<!-- End Mobile Nav -->
							</div>
							<div class="col-lg-7 col-md-9 col-12">
								<!-- Main Menu -->
								<div class="main-menu">
									<nav class="navigation">
										<ul class="nav menu">
											<li class="active"><a href="javascript:void(0)">Home <i class="rounded-down"></i></a>
												
											</li>
										</ul>
									</nav>
								</div>
								<!--/ End Main Menu -->
							</div>
							<div class="col-lg-2 col-12">
								<div class="get-quote">
									<a onclick="displayModal(event)" href="javascript:void(0)" class="btn">Check Chest X-ray</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--/ End Header Inner -->
		</header>
		<!-- End Header Area -->
		
		<!-- Slider Area -->
		<section class="slider">
			<div class="hero-slider">
				<!-- Start Single Slider -->
				<div class="single-slider" style="background-image: url('{% static 'img/slider2.jpg' %}')">
					<div class="container">
						<div class="row">
							<div class="col-lg-7">
								<div class="text">
									<h1>Experience the future of <br><span>Medical</span> diagnostics </h1>
									<p>Trust our advanced technology to provide you with clear, expert analysis of your X-ray images in no time. </p>
									<div class="button">
										<a onclick="displayModal(event)" href="javascript:void(0)" class="btn">Check Chest X-ray</a>
										<a onclick="displayEncryptionModal(event)" href="javascript:void(0)" class="btn" style="background-color: grey;">Check Encrypted images</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- End Single Slider -->
				<!-- Start Single Slider -->
				<div class="single-slider" style="background-image: url('{% static 'img/slider.jpg' %}')">
					<div class="container">
						<div class="row">
							<div class="col-lg-7">
								<div class="text">
									<h1>Share your <span>X-ray</span> with us and receive professional analysis  </h1>
									<p>Upload your images and let our sophisticated technology provide you with expert insights tailored to your health needs. </p>
									<div class="button">
										<a onclick="displayModal(event)" href="javascript:void(0)" class="btn">Check Chest X-ray</a>
										<a onclick="displayEncryptionModal(event)" href="javascript:void(0)" class="btn" style="background-color: grey;">Check Encrypted images</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- Start End Slider -->
				<!-- Start Single Slider -->
				<div class="single-slider" style="background-image: url('{% static 'img/slider3.jpg' %}')">
					<div class="container">
						<div class="row">
							<div class="col-lg-7">
								<div class="text">
									<h1>We Provide <span>Medical</span> Services That You Can <span>Trust!</span></h1>
									<p>Experience the confidence of having your X-ray images interpreted by cutting-edge AI technology designed for accuracy and clarity. </p>
									<div class="button">
										<a onclick="displayModal(event)" href="javascript:void(0)" class="btn">Check Chest X-ray</a>
										<a onclick="displayEncryptionModal(event)" href="javascript:void(0)" class="btn" style="background-color: grey;">Check Encrypted images</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- End Single Slider -->
			</div>
		</section>
		<!--/ End Slider Area -->
		
		<!-- Start Schedule Area -->
		<section class="schedule">
			<div class="container">
				<div class="schedule-inner">
					<div class="row">
						<div class="col-lg-4 col-md-6 col-12 ">
							<!-- single-schedule -->
							<div class="single-schedule first">
								<div class="inner">
									<div class="icon">
										<i class="fa fa-ambulance"></i>
									</div>
									<div class="single-content">
										<span>X-ray Result</span>
										<h4>Pneumonia</h4>
										<p>This result shows that there is <b>an existence</b> of Pneumonia in the image you uploaded into the platform.</p>
										<!-- <button onclick="displayModal(event)">test me</button> -->
									</div>
								</div>
							</div>
						</div>
						<div class="col-lg-4 col-md-6 col-12">
							<!-- single-schedule -->
							<div class="single-schedule middle">
								<div class="inner">
									<div class="icon">
										<i class="icofont-prescription"></i>
									</div>
									<div class="single-content">
										<span>X-ray Result</span>
										<h4>Normal</h4>
										<p>This result shows that there is <b>no existence</b> of Pneumonia in the image you uploaded into the platform.</p>
									</div>
								</div>
							</div>
						</div>
						<div class="col-lg-4 col-md-12 col-12">
							<!-- single-schedule -->
							<div class="single-schedule last">
								<div class="inner">
									<div class="icon">
										<i class="icofont-ui-clock"></i>
									</div>
									<div class="single-content">
										<span>X-ray Result</span>
										<h4>Invalid Image</h4>
										<p>This result shows that the image you uploaded is not a valid chest X-ray image.</p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<!--/End Start schedule Area -->

		<script src="http://code.jquery.com/jquery-3.2.1.min.js"></script>
		
		<!-- jquery Min JS -->
        <script src="{% static 'js/jquery.min.js' %}"></script>
		<!-- jquery Migrate JS -->
		<script src="{% static 'js/jquery-migrate-3.0.0.js' %}"></script>
		<!-- jquery Ui JS -->
		<script src="{% static 'js/jquery-ui.min.js' %}"></script>
		<!-- Easing JS -->
        <script src="{% static 'js/easing.js' %}"></script>
		<!-- Color JS -->
		<script src="{% static 'js/colors.js' %}"></script>
		<!-- Popper JS -->
		<script src="{% static 'js/popper.min.js' %}"></script>
		<!-- Bootstrap Datepicker JS -->
		<script src="{% static 'js/bootstrap-datepicker.js' %}"></script>
		<!-- Jquery Nav JS -->
        <script src="{% static 'js/jquery.nav.js' %}"></script>
		<!-- Slicknav JS -->
		<script src="{% static 'js/slicknav.min.js' %}"></script>
		<!-- ScrollUp JS -->
        <script src="{% static 'js/jquery.scrollUp.min.js' %}"></script>
		<!-- Niceselect JS -->
		<script src="{% static 'js/niceselect.js' %}"></script>
		<!-- Tilt Jquery JS -->
		<script src="{% static 'js/tilt.jquery.min.js' %}"></script>
		<!-- Owl Carousel JS -->
        <script src="{% static 'js/owl-carousel.js' %}"></script>
		<!-- counterup JS -->
		<script src="{% static 'js/jquery.counterup.min.js' %}"></script>
		<!-- Steller JS -->
		<script src="{% static 'js/steller.js' %}"></script>
		<!-- Wow JS -->
		<script src="{% static 'js/wow.min.js' %}"></script>
		<!-- Magnific Popup JS -->
		<script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
		<!-- Counter Up CDN JS -->
		<script src="http://cdnjs.cloudflare.com/ajax/libs/waypoints/2.0.3/waypoints.min.js"></script>
		<!-- Bootstrap JS -->
		<script src="{% static 'js/bootstrap.min.js' %}"></script>
		<!-- Main JS -->
		<script src="{% static 'js/main.js' %}"></script>

		<script>		

			function displayModal(event){
				Swal.fire({
					title: "Upload Chest X-ray",
					icon: "info",
					html: `
					<style>
						.file-upload input[type="file"] {
							display: none; 
						}

						.image-preview {
							max-width:50%;
							max-height: 50%; 
							border-radius: 5px; 
							display: none;
							position: absolute;
							top: 60%; 
							left: 50%; 
							transform: translate(-50%, -50%); 
						}

						.cbtn{
							border: 0;
							border-radius: 0.25em;
							background: initial;
							background-color: #2778c4;
							color: #fff;
							font-size: 1em;
							padding: 0.625em 1.1em;
						}
					</style>

						<form enctype="multipart/form-data" onsubmit="submitImage(event)">
							<label class="file-upload">
							<input onchange="previewSelectedImage(event)" type="file" accept="image/*" id="image" name="image" />
							<span class="icon">
								<img id="icon-img" src="{% static 'img/upload-icon.png' %}" alt=""> 								
							</span>
							<img id="image-preview" class="image-preview" src="" alt="Image Preview" />
							</label>	<br/><br/><br/>
						
							<div style="width: 100%; display: flex; justify-content: center">
								<button style="visibility: hidden" id="subBtn" class="swal2-styled swal2-confirm" type="submit" >
									<i class="fa fa-arrow-up"></i> Upload
								</button>
							</div>
						</form>
					`,
					showCloseButton: true,
					showConfirmButton: false

					});
			}

		
			function displayEncryptionModal(event){
				Swal.fire({
					title: "Upload Chest X-ray",
					icon: "info",
					html: `
					<style>
						.file-upload input[type="file"] {
							display: none; 
						}

						.image-preview {
							max-width:50%;
							max-height: 50%; 
							border-radius: 5px; 
							display: none;
							position: absolute;
							top: 60%; 
							left: 50%; 
							transform: translate(-50%, -50%); 
						}

						.cbtn{
							border: 0;
							border-radius: 0.25em;
							background: initial;
							background-color: #2778c4;
							color: #fff;
							font-size: 1em;
							padding: 0.625em 1.1em;
						}
					</style>

						<form enctype="multipart/form-data" onsubmit="submitEncImage(event)">
							<label class="file-upload">
							<input onchange="previewSelectedEncryptedImageFile(event)" type="file" accept="*" id="image_enc" name="image_enc" />
							<span class="icon">
								<img id="icon-img" src="{% static 'img/upload-icon.png' %}" alt=""> 								
							</span>
							<img id="image-preview" class="image-preview" src="" alt="Image Preview" />
							<span id="file-name-display"></span>
							
							</label>	<br/><br/><br/>
						
							<div style="width: 100%; display: flex; justify-content: center">
								<button style="visibility: hidden" id="subEncBtn" class="swal2-styled swal2-confirm" type="submit" >
									<i class="fa fa-arrow-up"></i> Upload
								</button>
							</div>
						</form>
					`,
					showCloseButton: true,
					showConfirmButton: false

					});
			}

		
			function displayErrorModalResult(data){
				Swal.fire({
					icon: "error",
					title: data,
					text: "Upload only a Chest X-Ray Image",					
				});
			}
			
			
			function displayWarningModalResult(data){
				Swal.fire({
					icon: "warning",
					title: data,
					text: "Chest X-Ray Image Analyzed Successfully!",
					footer: '<a target="_blank" href="https://my.clevelandclinic.org/health/diseases/4471-pneumonia">Why do I have this issue?</a>',
				});
			}
		
			function displaySuccessModalResult(data){
				Swal.fire({
					icon: "success",
					title: data,
					text: "The uploaded Image does not contain Pneumonia!",
					});
			}

			function submitImage(event){
				event.preventDefault();

				$('.preloader').removeClass('preloader-deactivate');

				let formData = new FormData(); // Create a FormData object
				let fileInput = document.getElementById('image');
				
				// Check if a file is selected
				if (fileInput.files.length > 0) {
					// Append the file to the FormData object
					formData.append('image', fileInput.files[0]); // 'image' is the name attribute of the input
				}

               $.ajax({
                    url: '/predict', // The URL to send the request to
                    type: 'POST',
                    data: formData,
                    contentType: false, 
                    processData: false, 
                    success: function(response) {
						$('.preloader').addClass('preloader-deactivate');

						if(response.payload === "Pneumonia"){
							displayWarningModalResult(response.payload)
						}else{
							displaySuccessModalResult(response.payload)
						}
						
						},
                    error: function(xhr, status, error) {
                        console.log(error)
                    }
                });
			}
			
			
			function submitEncImage(event){
				event.preventDefault();

				$('.preloader').removeClass('preloader-deactivate');

				let formData = new FormData(); // Create a FormData object
				let fileInput = document.getElementById('image_enc');
				
				// Check if a file is selected
				if (fileInput.files.length > 0) {
					// Append the file to the FormData object
					formData.append('image_enc', fileInput.files[0]); // 'image' is the name attribute of the input
				}

               $.ajax({
                    url: '/predict-enc', // The URL to send the request to
                    type: 'POST',
                    data: formData,
                    contentType: false, 
                    processData: false, 
                    success: function(response) {
						$('.preloader').addClass('preloader-deactivate');

						if(response.payload === "Pneumonia"){
							displayWarningModalResult(response.payload)
						}else{
							displaySuccessModalResult(response.payload)
						}
						
						},
                    error: function(xhr, status, error) {
                        console.log(error)
                    }
                });
			}


			function previewSelectedImage(event){
				const imagePreview = document.getElementById('image-preview');
				const iconImg = document.getElementById('icon-img');
				const subBtn = document.getElementById('subBtn');

				const file = event.target.files[0]; // Get the selected file
				iconImg.style.opacity = '0';
				if (file) {
					const reader = new FileReader(); // Create a FileReader object
					reader.onload = function(e) {
						imagePreview.src = e.target.result; // Set the image source to the file's data URL
						imagePreview.style.display = 'block'; // Show the image
					};
					reader.readAsDataURL(file); // Read the file as a data URL

					subBtn.style.visibility = "visible"
				}
			}


			function previewSelectedEncryptedImageFile(event) {
				const iconImg = document.getElementById('icon-img');
				const fileNameDisplay = document.getElementById('file-name-display');
				const subEncBtn = document.getElementById('subEncBtn');

				const file = event.target.files[0];
				iconImg.style.opacity = '0';

            if (file) {
                fileNameDisplay.textContent = file.name; // Show filename
				subEncBtn.style.visibility = "visible"
            }
        }


			function triggerFullScreen(event){
				event.preventDefault();

				$('.preloader').removeClass('preloader-deactivate');

				}
		</script>

    </body>
</html>